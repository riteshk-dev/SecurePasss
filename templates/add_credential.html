{% extends "base.html" %}

{% block title %}Add Credential - SecurePass{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="bi bi-plus-circle"></i> Add New Credential
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="POST" action="{{ url_for('add_credential') }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="website_name" class="form-label">
                                <i class="bi bi-globe"></i> Website Name *
                            </label>
                            <input type="text" class="form-control" id="website_name" 
                                   name="website_name" placeholder="e.g., Facebook, Gmail" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="website_url" class="form-label">
                                <i class="bi bi-link-45deg"></i> Website URL
                            </label>
                            <input type="url" class="form-control" id="website_url" 
                                   name="website_url" placeholder="https://example.com">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="username" class="form-label">
                            <i class="bi bi-person"></i> Username/Email *
                        </label>
                        <input type="text" class="form-control" id="username" 
                               name="username" placeholder="Your username or email" required>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">
                            <i class="bi bi-lock"></i> Password *
                        </label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="password" 
                                   name="password" placeholder="Enter password" required>
                            <button class="btn btn-outline-secondary" type="button" 
                                    id="togglePassword" title="Toggle password visibility">
                                <i class="bi bi-eye" id="toggleIcon"></i>
                            </button>
                            <button class="btn btn-outline-primary" type="button" 
                                    id="generatePassword" title="Generate strong password">
                                <i class="bi bi-arrow-clockwise"></i> Generate
                            </button>
                        </div>
                        <div class="form-text">
                            <span id="passwordStrength"></span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="notes" class="form-label">
                            <i class="bi bi-sticky"></i> Notes (Optional)
                        </label>
                        <textarea class="form-control" id="notes" name="notes" rows="3" 
                                  placeholder="Additional notes about this credential"></textarea>
                    </div>

                    <hr class="my-4">

                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Save Credential
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Toggle password visibility
    document.getElementById('togglePassword').addEventListener('click', function() {
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('toggleIcon');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('bi-eye');
            toggleIcon.classList.add('bi-eye-slash');
        } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('bi-eye-slash');
            toggleIcon.classList.add('bi-eye');
        }
    });

    // Generate strong password
    document.getElementById('generatePassword').addEventListener('click', async function() {
        try {
            const response = await fetch('/api/generate-password?length=16');
            const data = await response.json();
            document.getElementById('password').value = data.password;
            document.getElementById('password').type = 'text';
            document.getElementById('toggleIcon').classList.remove('bi-eye');
            document.getElementById('toggleIcon').classList.add('bi-eye-slash');
            checkPasswordStrength(data.password);
        } catch (error) {
            alert('Failed to generate password');
        }
    });

    // Password strength checker
    function checkPasswordStrength(password) {
        const strengthIndicator = document.getElementById('passwordStrength');
        let strength = 0;
        let message = '';
        let color = '';

        if (password.length >= 8) strength++;
        if (password.length >= 12) strength++;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        if (/\d/.test(password)) strength++;
        if (/[^a-zA-Z0-9]/.test(password)) strength++;

        if (strength <= 2) {
            message = 'Weak password';
            color = 'text-danger';
        } else if (strength <= 3) {
            message = 'Moderate password';
            color = 'text-warning';
        } else {
            message = 'Strong password';
            color = 'text-success';
        }

        strengthIndicator.textContent = message;
        strengthIndicator.className = color;
    }

    // Check password strength on input
    document.getElementById('password').addEventListener('input', function() {
        checkPasswordStrength(this.value);
    });
</script>
{% endblock %}