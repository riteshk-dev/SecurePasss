{% extends "base.html" %}

{% block title %}Edit Credential - SecurePass{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="bi bi-pencil"></i> Edit Credential
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="POST" action="{{ url_for('edit_credential', credential_id=credential.credential_id) }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="website_name" class="form-label">
                                <i class="bi bi-globe"></i> Website Name *
                            </label>
                            <input type="text" class="form-control" id="website_name" 
                                   name="website_name" value="{{ credential.website_name }}" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="website_url" class="form-label">
                                <i class="bi bi-link-45deg"></i> Website URL
                            </label>
                            <input type="url" class="form-control" id="website_url" 
                                   name="website_url" value="{{ credential.website_url or '' }}">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="username" class="form-label">
                            <i class="bi bi-person"></i> Username/Email *
                        </label>
                        <input type="text" class="form-control" id="username" 
                               name="username" value="{{ credential.username }}" required>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">
                            <i class="bi bi-lock"></i> Password
                        </label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="password" 
                                   name="password" value="{{ password }}" 
                                   placeholder="Leave blank to keep current password">
                            <button class="btn btn-outline-secondary" type="button" 
                                    id="togglePassword" title="Toggle password visibility">
                                <i class="bi bi-eye" id="toggleIcon"></i>
                            </button>
                            <button class="btn btn-outline-primary" type="button" 
                                    id="generatePassword" title="Generate new password">
                                <i class="bi bi-arrow-clockwise"></i> Generate
                            </button>
                        </div>
                        <div class="form-text text-warning">
                            <i class="bi bi-exclamation-triangle"></i> Leave blank to keep existing password
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="notes" class="form-label">
                            <i class="bi bi-sticky"></i> Notes (Optional)
                        </label>
                        <textarea class="form-control" id="notes" name="notes" rows="3">{{ credential.notes or '' }}</textarea>
                    </div>

                    <hr class="my-4">

                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-warning">
                            <i class="bi bi-save"></i> Update Credential
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Toggle password visibility
    document.getElementById('togglePassword').addEventListener('click', function() {
        const passwordInput = document.getElementById('password');
        const toggleIcon = document.getElementById('toggleIcon');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleIcon.classList.remove('bi-eye');
            toggleIcon.classList.add('bi-eye-slash');
        } else {
            passwordInput.type = 'password';
            toggleIcon.classList.remove('bi-eye-slash');
            toggleIcon.classList.add('bi-eye');
        }
    });

    // Generate strong password
    document.getElementById('generatePassword').addEventListener('click', async function() {
        if (!confirm('Generate a new password? This will replace the existing password.')) {
            return;
        }
        
        try {
            const response = await fetch('/api/generate-password?length=16');
            const data = await response.json();
            document.getElementById('password').value = data.password;
            document.getElementById('password').type = 'text';
            document.getElementById('toggleIcon').classList.remove('bi-eye');
            document.getElementById('toggleIcon').classList.add('bi-eye-slash');
        } catch (error) {
            alert('Failed to generate password');
        }
    });
</script>
{% endblock %}